%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% CSCI 1430 Writeup Template
%
% This is a LaTeX document. LaTeX is a markup language for producing
% documents. Your task is to fill out this
% document, then to compile this into a PDF document.
%
% TO COMPILE:
% > pdflatex thisfile.tex
%
% For references to appear correctly instead of as '??', you must run
% pdflatex twice.
%
% If you do not have LaTeX and need a LaTeX distribution:
% - Departmental machines have one installed.
% - Personal laptops (all common OS): www.latex-project.org/get/
%
% If you need help with LaTeX, please come to office hours.
% Or, there is plenty of help online:
% https://en.wikibooks.org/wiki/LaTeX
%
% Good luck!
% James and the 1430 staff
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% How to include two graphics on the same line:
%
% \includegraphics[\width=0.49\linewidth]{yourgraphic1.png}
% \includegraphics[\width=0.49\linewidth]{yourgraphic2.png}
%
% How to include equations:
%
% \begin{equation}
% y = mx+c
% \end{equation}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[colorlinks = true,
            linkcolor = blue,
            urlcolor  = blue]{hyperref}
\usepackage[a4paper,margin=1.5in]{geometry}
\usepackage{stackengine,graphicx}
\usepackage{fancyhdr}
\setlength{\headheight}{15pt}
\usepackage{microtype}
\usepackage{times}
\usepackage{booktabs}

% python code format: https://github.com/olivierverdier/python-latex-highlighting
\usepackage{pythonhighlight}

\frenchspacing
\setlength{\parindent}{0cm} % Default is 15pt.
\setlength{\parskip}{0.3cm plus1mm minus1mm}

\pagestyle{fancy}
\fancyhf{}
\lhead{Project 1 Writeup}
\rhead{CSCI 1430}
\rfoot{\thepage}

\date{}

\title{\vspace{-1cm}Project 1 Writeup}


\begin{document}
\maketitle
\vspace{-2cm}
\thispagestyle{fancy}

\section*{Instructions}
\begin{itemize}
  \item Provide an overview about how your project functions. 
  \item Describe any interesting decisions you made to write your algorithm.
  \item Show and discuss the results of your algorithm.
  \item Feel free to include code snippets, images, and equations.
  \item List any extra credit implementation and result (optional).
  \item Use as many pages as you need, but err on the short side.
  \item \textbf{Please make this document anonymous.}
\end{itemize}

\section*{Project Overview}

This project aims to implement two functions \verb|myfilter()| and \verb|gen_hybrid_image()|. Different types of filters are applied to images to test \verb|myfilter()| function. As for \verb|gen_hybrid_image()|, besides testing with extra pairs of images, the effect of image assignment sequence to image1 and image2 is also investigated.

\section*{Implementation Detail}

Here is the implemetation for \verb|myfilter()|. At first, shapes of the kernel and image are obtained and an error message is raised if the filter has an even-dimension. In order to support both grayscale and RGB pictures, the grayscale picture is reshaped to a 3d array, so that we don't need to worry about the dimensions difference between grayscale and RGB picture. Then, the image is padded with 0 on the hight and width dimension using \verb|np.pad()|. The kernel is flipped using \verb|np.flit()| as we want to realize convolution operation. After all above manipulations, the output is obtained by taken dot product between \verb|flipped_kernel| and \verb|padded_image|. 

I have tried two ways to obtain the product output of \verb|flipped_kernel| and \verb|padded_image|. (Both are included below) The first implementation is an ordinary way

At last, if the input image is grayscale, the output is reshaped back to 2D to keep the result the same dimension as the input.
\begin{python}
(k, l) = kernel.shape
(m, n, c) = image.shape
if (k * l) % 2 == 0:
    raise Exception("Output with even filters are not defined!")

Grayscale = False
if len(image.shape) == 2:
    Grayscale = True
    image = np.reshape(image, (image.shape[0], image.shape[1], 1))

padded_image = np.pad(image, ((k // 2, k // 2), (l // 2, l // 2), (0, 0)), "constant")
# because we want to calculate convolution, we need to flip the kernel
flipped_kernel = np.flip(kernel)

# First Implementation
output = np.zeros(image.shape)
for i in range(m):
    for j in range(n):
        output[i, j] = np.tensordot(flipped_kernel, padded_image[i : i + k, j : j + l], axes=[(0, 1), (0, 1)])

# Second Implementation
expanded_image = np.lib.stride_tricks.as_strided(
        padded_image,
        shape=(
            m,
            n,
            c,
            k,
            l,
        ),
        strides=(
            padded_image.strides[0],
            padded_image.strides[1],
            padded_image.strides[2],
            padded_image.strides[0],
            padded_image.strides[1],
        ),
        writeable=False,
    )

output = np.einsum("xyzij, ij->xyz", expanded_image, flipped_kernel)

if Grayscale:
    output = output.reshape(output, (m, n))
filtered_image = output
\end{python}
\section*{Result}

\begin{enumerate}
    \item Results for different filters

    \item results for hybrid with different sequence.
\end{enumerate}

\begin{figure}[h]
    \centering
    \includegraphics[width=5cm]{placeholder.jpg}
    \includegraphics[width=5cm]{placeholder.jpg}
    \caption{\emph{Left:} My result was spectacular. \emph{Right:} Curious.}
    \label{fig:result1}
\end{figure}

\section*{Extra Credit (Optional)}
\begin{enumerate}
   
    \item Pad with reflected image content
        \begin{python}
        one = 1;
        two = one + one;
        if two == 2
            disp( 'This computer is not broken.' );
        end
        \end{python}
    
    \item own hybrid image
        \begin{python}
        one = 1;
        two = one + one;
        if two == 2
            disp( 'This computer is not broken.' );
        end
        \end{python} 

    \item FFT-based convolution
        \begin{python}
        one = 1;
        two = one + one;
        if two == 2
            disp( 'This computer is not broken.' );
        end
        \end{python} 
\end{enumerate}

\end{document}
